<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Amostras Weibull</title>
</head>
<body>
  
<div id="resultados"></div>

  <script>

    function weibull(shape, scale, size) { 
      let values = []; 
      for (let i = 0; i < size; i++) { 
          let u = Math.random(); // Uniform random number between 0 and 1 
          let w = scale * Math.pow(-Math.log(1 - u), 1 / shape); 
          values.push(w); 
      } 
      return values; 
    } 
    
    function calculateStatistics(arr) { 
      const sum = arr.reduce((a, b) => a + b, 0); 
      const mean = sum / arr.length; 
      const variance = arr.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / arr.length; 
      const stdDev = Math.sqrt(variance); 
      const min = Math.min(...arr); 
      const max = Math.max(...arr); 
      return { mean, stdDev, min, max }; 
    } 
    
    function resultados(result) { 
      const { mean, stdDev } = calculateStatistics(result); 
      const json_object = { 
        "média": mean, 
        "dp": stdDev, 
        "lista": result 
      }; 
      console.log(json_object); 
      return json_object; 
    } 
    
    function invoke(tamanho, forma, escala, numero) { 
      console.log("Received parameters:", { tamanho, forma, escala, numero }); 
      if ([tamanho, forma, escala].some(param => param === undefined) || [tamanho, forma, escala].some(param => param <= 0)) {
        console.log("Corrija valores não positivos ou parâmetros em falta"); 
        alert("Corrija valores não positivos ou parâmetros em falta"); 
        return; 
      } 
      if (isNaN(numero) || numero <= 0) { 
        const result = weibull(forma, escala, tamanho); 
        console.log(result);
        return JSON.stringify(resultados(result)); 
      } 
      
      const medias = []; 
      const dps = []; 
      const maxs = []; 
      const mins = []; 
      for (let x = 0; x < numero; x++) { 
        const result = weibull(forma, escala, tamanho); 
        const stats = calculateStatistics(result); 
        medias.push(stats.mean); 
        dps.push(stats.stdDev); 
        maxs.push(stats.max); 
        mins.push(stats.min); 
      } 
      const json_object = { 
        "0. cabeçalhos,": "médias, desvios padrão, mínimos, máximos", 
        "1. média das,": `${medias.reduce((a, b) => a + b, 0) / medias.length}, ${dps.reduce((a, b) => a + b, 0) / dps.length}, ${mins.reduce((a, b) => a + b, 0) / mins.length}, ${maxs.reduce((a, b) => a + b, 0) / maxs.length}`, 
        "2. desvio padrão das,": `${Math.sqrt(medias.reduce((a, b) => a + Math.pow(b - (medias.reduce((a, b) => a + b, 0) / medias.length), 2), 0) / medias.length)}, ${Math.sqrt(dps.reduce((a, b) => a + Math.pow(b - (dps.reduce((a, b) => a + b, 0) / dps.length), 2), 0) / dps.length)}, ${Math.sqrt(mins.reduce((a, b) => a + Math.pow(b - (mins.reduce((a, b) => a + b, 0) / mins.length), 2), 0) / mins.length)}, ${Math.sqrt(maxs.reduce((a, b) => a + Math.pow(b - (maxs.reduce((a, b) => a + b, 0) / maxs.length), 2), 0) / maxs.length)}`, 
        "3. mínimo das,": `${Math.min(...medias)}, ${Math.min(...dps)}, ${Math.min(...mins)}, ${Math.min(...maxs)}`, 
        "4. máximo das,": `${Math.max(...medias)}, ${Math.max(...dps)}, ${Math.max(...mins)}, ${Math.max(...maxs)}`, 
        "5. médias": medias, 
        "6. desvios padrão": dps, 
        "7. mínimos": mins, 
        "8. máximos": maxs 
      }; 
      console.log(json_object); 
      return JSON.stringify(json_object); 
    }
    
    const forma = parseFloat((location.search.split('forma=')[1]||'').split('&')[0].replace(",","."));
    const escala = parseFloat((location.search.split('escala=')[1]||'').split('&')[0].replace(",","."));
    const tamanho = parseInt((location.search.split('tamanho=')[1]||'').split('&')[0].replace(",","."));
    const numero = parseInt((location.search.split('numero=')[1]||'').split('&')[0].replace(",","."));
    console.log(numero);
    
    document.getElementById("resultados").innerText = invoke(tamanho, forma, escala, numero);

    
  </script>
</body>
</html>
